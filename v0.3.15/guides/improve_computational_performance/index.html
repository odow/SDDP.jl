<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Improve computational performance · SDDP.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="SDDP.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">SDDP.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorial/01_first_steps/">Basic I: first steps</a></li><li><a class="tocitem" href="../../tutorial/02_adding_uncertainty/">Basic II: adding uncertainty</a></li><li><a class="tocitem" href="../../tutorial/03_objective_uncertainty/">Basic III: objective uncertainty</a></li><li><a class="tocitem" href="../../tutorial/04_markov_uncertainty/">Basic IV: Markov uncertainty</a></li><li><a class="tocitem" href="../../tutorial/05_plotting/">Basic V: plotting</a></li><li><a class="tocitem" href="../../tutorial/06_warnings/">Basic VI: words of warning</a></li><li><a class="tocitem" href="../../tutorial/11_objective_states/">Advanced I: objective states</a></li><li><a class="tocitem" href="../../tutorial/12_belief_states/">Advanced II: belief states</a></li><li><a class="tocitem" href="../../tutorial/13_integrality/">Advanced III: integrality</a></li><li><a class="tocitem" href="../../tutorial/21_theory_intro/">Theory I: an intro to SDDP</a></li><li><a class="tocitem" href="../../tutorial/22_risk/">Theory II: risk aversion</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">How-to guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../acess_previous_variables/">Access variables from a previous stage</a></li><li><a class="tocitem" href="../add_a_multidimensional_state_variable/">Add a multi-dimensional state variable</a></li><li><a class="tocitem" href="../add_a_risk_measure/">Add a risk measure</a></li><li><a class="tocitem" href="../add_multidimensional_noise_Terms/">Add multi-dimensional noise terms</a></li><li><a class="tocitem" href="../add_noise_in_the_constraint_matrix/">Add noise in the constraint matrix</a></li><li><a class="tocitem" href="../choose_a_stopping_rule/">Choose a stopping rule</a></li><li><a class="tocitem" href="../create_a_general_policy_graph/">Create a general policy graph</a></li><li><a class="tocitem" href="../debug_a_model/">Debug a model</a></li><li class="is-active"><a class="tocitem" href>Improve computational performance</a><ul class="internal"><li><a class="tocitem" href="#Numerical-stability-(again)"><span>Numerical stability (again)</span></a></li><li><a class="tocitem" href="#Solver-selection"><span>Solver selection</span></a></li></ul></li><li><a class="tocitem" href="../simulate_using_a_different_sampling_scheme/">Simulate using a different sampling scheme</a></li><li><a class="tocitem" href="../upgrade_from_the_old_sddp/">Upgrade from the old SDDP.jl</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/FAST_hydro_thermal/">FAST: the hydro-thermal problem</a></li><li><a class="tocitem" href="../../examples/FAST_production_management/">FAST: the production management problem</a></li><li><a class="tocitem" href="../../examples/FAST_quickstart/">FAST: the quickstart problem</a></li><li><a class="tocitem" href="../../examples/Hydro_thermal/">Hydro-thermal scheduling</a></li><li><a class="tocitem" href="../../examples/StochDynamicProgramming.jl_multistock/">StochDynamicProgramming: the multistock problem</a></li><li><a class="tocitem" href="../../examples/StochDynamicProgramming.jl_stock/">StochDynamicProgramming: the stock problem</a></li><li><a class="tocitem" href="../../examples/StructDualDynProg.jl_prob5.2_2stages/">StructDualDynProg: Problem 5.2, 2 stages</a></li><li><a class="tocitem" href="../../examples/StructDualDynProg.jl_prob5.2_3stages/">StructDualDynProg: Problem 5.2, 3 stages</a></li><li><a class="tocitem" href="../../examples/agriculture_mccardle_farm/">The farm planning problem</a></li><li><a class="tocitem" href="../../examples/air_conditioning/">Air conditioning</a></li><li><a class="tocitem" href="../../examples/all_blacks/">Deterministic All Blacks</a></li><li><a class="tocitem" href="../../examples/asset_management_simple/">Asset management</a></li><li><a class="tocitem" href="../../examples/asset_management_stagewise/">Asset management with modifications</a></li><li><a class="tocitem" href="../../examples/belief/">Partially observable inventory management</a></li><li><a class="tocitem" href="../../examples/biobjective_hydro/">Biobjective hydro-thermal</a></li><li><a class="tocitem" href="../../examples/booking_management/">Booking management</a></li><li><a class="tocitem" href="../../examples/generation_expansion/">Generation expansion</a></li><li><a class="tocitem" href="../../examples/hydro_valley/">Hydro valleys</a></li><li><a class="tocitem" href="../../examples/infinite_horizon_hydro_thermal/">Infinite horizon hydro-thermal</a></li><li><a class="tocitem" href="../../examples/infinite_horizon_trivial/">Infinite horizon trivial</a></li><li><a class="tocitem" href="../../examples/no_strong_duality/">No strong duality</a></li><li><a class="tocitem" href="../../examples/objective_state_newsvendor/">Newsvendor</a></li><li><a class="tocitem" href="../../examples/sldp_example_one/">SLDP: example 1</a></li><li><a class="tocitem" href="../../examples/sldp_example_two/">SLDP: example 2</a></li><li><a class="tocitem" href="../../examples/stochastic_all_blacks/">Stochastic All Blacks</a></li><li><a class="tocitem" href="../../examples/the_farmers_problem/">The farmer&#39;s problem</a></li><li><a class="tocitem" href="../../examples/vehicle_location/">Vehicle location</a></li></ul></li><li><a class="tocitem" href="../../apireference/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How-to guides</a></li><li class="is-active"><a href>Improve computational performance</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Improve computational performance</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/odow/SDDP.jl/blob/master/docs/src/guides/improve_computational_performance.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Improve-computational-performance"><a class="docs-heading-anchor" href="#Improve-computational-performance">Improve computational performance</a><a id="Improve-computational-performance-1"></a><a class="docs-heading-anchor-permalink" href="#Improve-computational-performance" title="Permalink"></a></h1><p>SDDP is a computationally intensive algorithm. Here are some suggestions for how the computational performance can be improved.</p><h2 id="Numerical-stability-(again)"><a class="docs-heading-anchor" href="#Numerical-stability-(again)">Numerical stability (again)</a><a id="Numerical-stability-(again)-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-stability-(again)" title="Permalink"></a></h2><p>We&#39;ve already discussed this in the <a href="../../tutorial/06_warnings/#Numerical-stability">Numerical stability</a> section of <a href="../../tutorial/06_warnings/#Basic-VI:-words-of-warning">Basic VI: words of warning</a>. But, it&#39;s so important that we&#39;re going to say it again: improving the problem scaling is one of the best ways to improve the numerical performance of your models.</p><h2 id="Solver-selection"><a class="docs-heading-anchor" href="#Solver-selection">Solver selection</a><a id="Solver-selection-1"></a><a class="docs-heading-anchor-permalink" href="#Solver-selection" title="Permalink"></a></h2><p>The majority of the solution time is spent inside the low-level solvers. Choosing which solver (and the associated settings) correctly can lead to big speed-ups.</p><ul><li><p>Choose a commercial solver.</p><p>Options include <a href="https://github.com/JuliaOpt/CPLEX.jl">CPLEX</a>, <a href="https://github.com/JuliaOpt/Gurobi.jl">Gurobi</a>, and <a href="https://github.com/JuliaOpt/Xpress.jl">Xpress</a>. Using free solvers such as <a href="https://github.com/JuliaOpt/Clp.jl">CLP</a> and <a href="https://github.com/JuliaOpt/GLPK.jl">GLPK</a> isn&#39;t a viable approach for large problems.</p></li><li><p>Try different solvers.</p></li></ul><p>Even commercial solvers can have wildly different solution times. We&#39;ve seen   models on which CPLEX was 50% fast than Gurobi, and vice versa.</p><ul><li><p>Experiment with different solver options.</p><p>Using the default settings is usually a good option. However, sometimes it can pay to change these. In particular, forcing solvers to use the dual simplex algorithm (e.g., <a href="https://www.gurobi.com/documentation/8.1/refman/method.html"><code>Method=1</code> in Gurobi</a> ) is usually a performance win.</p></li></ul><h3 id="Single-cut-vs.-multi-cut"><a class="docs-heading-anchor" href="#Single-cut-vs.-multi-cut">Single-cut vs. multi-cut</a><a id="Single-cut-vs.-multi-cut-1"></a><a class="docs-heading-anchor-permalink" href="#Single-cut-vs.-multi-cut" title="Permalink"></a></h3><p>There are two competing ways that cuts can be created in SDDP: <em>single</em>-cut and <em>multi</em>-cut. By default, <code>SDDP.jl</code> uses the <em>single-cut</em> version of SDDP.</p><p>The performance of each method is problem-dependent. We recommend that you try both in order to see which one performs better. In general, the <em>single</em>-cut method works better when the number of realizations of the stagewise-independent random variable is large, whereas the multi-cut method works better on small problems. However, the multi-cut method can cause numerical stability problems, particularly if used in conjunction with objective or belief state variables.</p><p>You can switch between the methods by passing the relevant flag to <code>cut_type</code> in <a href="../../apireference/#SDDP.train"><code>SDDP.train</code></a>.</p><pre><code class="language-julia">SDDP.train(model; cut_type = SDDP.SINGLE_CUT)
SDDP.train(model; cut_type = SDDP.MULTI_CUT)</code></pre><h3 id="Parallelism"><a class="docs-heading-anchor" href="#Parallelism">Parallelism</a><a id="Parallelism-1"></a><a class="docs-heading-anchor-permalink" href="#Parallelism" title="Permalink"></a></h3><p>SDDP.jl can take advantage of the parallel nature of modern computers to solve problems across multiple cores.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>We highly recommend that you read the Julia manual&#39;s section on <a href="https://docs.julialang.org/en/v1/manual/parallel-computing/">parallel computing</a>.</p></div></div><p>You can start Julia from a command line with <code>N</code> processors using the <code>-p</code> flag:</p><pre><code class="language-julia">julia -p N</code></pre><p>Alternatively, you can use the <code>Distributed.jl</code> package:</p><pre><code class="language-julia">using Distributed
Distributed.addprocs(N)</code></pre><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Workers <strong>DON&#39;T</strong> inherit their parent&#39;s Pkg environment. Therefore, if you started Julia with <code>--project=/path/to/environment</code> (or if you activated an environment from the REPL), you will need to put the following at the top of your script:</p><pre><code class="language-julia">using Distributed
@everywhere begin
    import Pkg
    Pkg.activate(&quot;/path/to/environment&quot;)
end</code></pre></div></div><p>Currently SDDP.jl supports to parallel schemes, <a href="../../apireference/#SDDP.Serial"><code>SDDP.Serial</code></a> and <a href="../../apireference/#SDDP.Asynchronous"><code>SDDP.Asynchronous</code></a>. Instances of these parallel schemes should be passed to the <code>parallel_scheme</code> argument of <a href="../../apireference/#SDDP.train"><code>SDDP.train</code></a> and <a href="../../apireference/#SDDP.simulate"><code>SDDP.simulate</code></a>.</p><pre><code class="language-julia">using SDDP, GLPK
model = SDDP.LinearPolicyGraph(
  stages = 2, lower_bound = 0, optimizer = GLPK.Optimizer
) do sp, t
     @variable(sp, x &gt;= 0, SDDP.State, initial_value = 1)
     @stageobjective(sp, x.out)
end
SDDP.train(model; iteration_limit = 10, parallel_scheme = SDDP.Asynchronous())
SDDP.simulate(model, 10; parallel_scheme = SDDP.Asynchronous())</code></pre><p>There is a large overhead for using the asynchronous solver. Even if you choose asynchronous mode, SDDP.jl will start in serial mode while the initialization takes place. Therefore, in the log you will see that the initial iterations take place on the master thread (<code>Proc. ID = 1</code>), and it is only after while that the solve switches to full parallelism.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>Because of the large data communication requirements (all cuts have to be shared with all other cores), the solution time will not scale linearly with the number of cores.</p></div></div><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>Given the same number of iterations, the policy obtained from asynchronous mode will be <em>worse</em> than the policy obtained from serial mode. However, the asynchronous solver can take significantly less time to compute the same number of iterations.</p></div></div><h4 id="Data-movement"><a class="docs-heading-anchor" href="#Data-movement">Data movement</a><a id="Data-movement-1"></a><a class="docs-heading-anchor-permalink" href="#Data-movement" title="Permalink"></a></h4><p>By defualt, data defined on the master process is not made available to the workers. Therefore, a model like the following:</p><pre><code class="language-julia">data = 1
model = SDDP.LinearPolicyGraph(stages = 2, lower_bound = 0) do sp, t
     @variable(sp, x &gt;= 0, SDDP.State, initial_value = data)
     @stageobjective(sp, x.out)
end</code></pre><p>will result in an <code>UndefVarError</code> error like <code>UndefVarError: data not defined</code>.</p><p>There are three solutions for this problem.</p><h5 id="Option-1:-declare-data-inside-the-build-function"><a class="docs-heading-anchor" href="#Option-1:-declare-data-inside-the-build-function">Option 1: declare data inside the build function</a><a id="Option-1:-declare-data-inside-the-build-function-1"></a><a class="docs-heading-anchor-permalink" href="#Option-1:-declare-data-inside-the-build-function" title="Permalink"></a></h5><pre><code class="language-julia">model = SDDP.LinearPolicyGraph(stages = 2) do sp, t
    data = 1
    @variable(sp, x &gt;= 0, SDDP.State, initial_value = 1)
    @stageobjective(sp, x)
end</code></pre><h5 id="Option-2:-use-@everywhere"><a class="docs-heading-anchor" href="#Option-2:-use-@everywhere">Option 2: use <code>@everywhere</code></a><a id="Option-2:-use-@everywhere-1"></a><a class="docs-heading-anchor-permalink" href="#Option-2:-use-@everywhere" title="Permalink"></a></h5><pre><code class="language-julia">@everywhere begin
    data = 1
end
model = SDDP.LinearPolicyGraph(stages = 2) do sp, t
    @variable(sp, x &gt;= 0, SDDP.State, initial_value = 1)
    @stageobjective(sp, x)
end</code></pre><h5 id="Option-3:-build-the-model-in-a-function"><a class="docs-heading-anchor" href="#Option-3:-build-the-model-in-a-function">Option 3: build the model in a function</a><a id="Option-3:-build-the-model-in-a-function-1"></a><a class="docs-heading-anchor-permalink" href="#Option-3:-build-the-model-in-a-function" title="Permalink"></a></h5><pre><code class="language-julia">function build_model()
    data = 1
    return SDDP.LinearPolicyGraph(stages = 2) do sp, t
        @variable(sp, x &gt;= 0, SDDP.State, initial_value = 1)
        @stageobjective(sp, x)
    end
end

model = build_model()</code></pre><h4 id="Initialization-hooks"><a class="docs-heading-anchor" href="#Initialization-hooks">Initialization hooks</a><a id="Initialization-hooks-1"></a><a class="docs-heading-anchor-permalink" href="#Initialization-hooks" title="Permalink"></a></h4><p><a href="../../apireference/#SDDP.Asynchronous"><code>SDDP.Asynchronous</code></a> accepts a pre-processing hook that is run on each worker process <em>before</em> the model is solved. The most useful situation is for solvers than need an initialization step. A good example is Gurobi, which can share an environment amongst all models on a worker. Notably, this environment <strong>cannot</strong> be shared amongst workers, so defining one environment at the top of a script will fail!</p><p>To initialize a new environment on each worker, use the following:</p><pre><code class="language-julia">SDDP.train(
    model,
    parallel_scheme = SDDP.Asynchronous() do m
        env = Gurobi.Env()
        optimizer = with_optimizer(Gurobi.Optimizer, env, OutputFlag = 0)
        for node in values(m.nodes)
            set_optimizer(node.subproblem, optimizer)
        end
    end
)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../debug_a_model/">« Debug a model</a><a class="docs-footer-nextpage" href="../simulate_using_a_different_sampling_scheme/">Simulate using a different sampling scheme »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 31 May 2021 22:17">Monday 31 May 2021</span>. Using Julia version 1.0.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
