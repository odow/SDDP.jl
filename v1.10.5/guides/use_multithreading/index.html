<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Use multithreading · SDDP.jl</title><meta name="title" content="Use multithreading · SDDP.jl"/><meta property="og:title" content="Use multithreading · SDDP.jl"/><meta property="twitter:title" content="Use multithreading · SDDP.jl"/><meta name="description" content="Documentation for SDDP.jl."/><meta property="og:description" content="Documentation for SDDP.jl."/><meta property="twitter:description" content="Documentation for SDDP.jl."/><script async src="https://www.googletagmanager.com/gtag/js?id=G-HZQQDVMPZW"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HZQQDVMPZW', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="SDDP.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorial/first_steps/">An introduction to SDDP.jl</a></li><li><a class="tocitem" href="../../tutorial/objective_uncertainty/">Uncertainty in the objective function</a></li><li><a class="tocitem" href="../../tutorial/markov_uncertainty/">Markovian policy graphs</a></li><li><a class="tocitem" href="../../tutorial/plotting/">Plotting tools</a></li><li><a class="tocitem" href="../../tutorial/warnings/">Words of warning</a></li><li><a class="tocitem" href="../../tutorial/arma/">Auto-regressive stochastic processes</a></li><li><a class="tocitem" href="../../tutorial/decision_hazard/">Here-and-now and hazard-decision</a></li><li><a class="tocitem" href="../../tutorial/objective_states/">Objective states</a></li><li><a class="tocitem" href="../../tutorial/pglib_opf/">Alternative forward models</a></li><li><a class="tocitem" href="../../tutorial/mdps/">Example: Markov Decision Processes</a></li><li><a class="tocitem" href="../../tutorial/example_newsvendor/">Example: two-stage newsvendor</a></li><li><a class="tocitem" href="../../tutorial/example_reservoir/">Example: deterministic to stochastic</a></li><li><a class="tocitem" href="../../tutorial/example_milk_producer/">Example: the milk producer</a></li><li><a class="tocitem" href="../../tutorial/inventory/">Example: inventory management</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">How-to guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Use multithreading</a><ul class="internal"><li><a class="tocitem" href="#Enabling-threads"><span>Enabling threads</span></a></li><li><a class="tocitem" href="#Multithreading-with-SDDP"><span>Multithreading with SDDP</span></a></li><li><a class="tocitem" href="#Choosing-the-number-of-threads"><span>Choosing the number of threads</span></a></li></ul></li><li><a class="tocitem" href="../access_previous_variables/">Access variables from a previous stage</a></li><li><a class="tocitem" href="../add_a_multidimensional_state_variable/">Add a multi-dimensional state variable</a></li><li><a class="tocitem" href="../add_a_risk_measure/">Add a risk measure</a></li><li><a class="tocitem" href="../add_integrality/">Integrality</a></li><li><a class="tocitem" href="../add_multidimensional_noise/">Add multi-dimensional noise terms</a></li><li><a class="tocitem" href="../add_noise_in_the_constraint_matrix/">Add noise in the constraint matrix</a></li><li><a class="tocitem" href="../choose_a_stopping_rule/">Choose a stopping rule</a></li><li><a class="tocitem" href="../create_a_general_policy_graph/">Create a general policy graph</a></li><li><a class="tocitem" href="../add_a_custom_cut/">Add a custom cut</a></li><li><a class="tocitem" href="../debug_a_model/">Debug a model</a></li><li><a class="tocitem" href="../improve_computational_performance/">Improve computational performance</a></li><li><a class="tocitem" href="../simulate_using_a_different_sampling_scheme/">Simulate using a different sampling scheme</a></li><li><a class="tocitem" href="../create_a_belief_state/">Create a belief state</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Explanation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../explanation/theory_intro/">Introductory theory</a></li><li><a class="tocitem" href="../../explanation/risk/">Risk aversion</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/FAST_hydro_thermal/">FAST: the hydro-thermal problem</a></li><li><a class="tocitem" href="../../examples/FAST_production_management/">FAST: the production management problem</a></li><li><a class="tocitem" href="../../examples/FAST_quickstart/">FAST: the quickstart problem</a></li><li><a class="tocitem" href="../../examples/Hydro_thermal/">Hydro-thermal scheduling</a></li><li><a class="tocitem" href="../../examples/StochDynamicProgramming.jl_multistock/">StochDynamicProgramming: the multistock problem</a></li><li><a class="tocitem" href="../../examples/StochDynamicProgramming.jl_stock/">StochDynamicProgramming: the stock problem</a></li><li><a class="tocitem" href="../../examples/StructDualDynProg.jl_prob5.2_2stages/">StructDualDynProg: Problem 5.2, 2 stages</a></li><li><a class="tocitem" href="../../examples/StructDualDynProg.jl_prob5.2_3stages/">StructDualDynProg: Problem 5.2, 3 stages</a></li><li><a class="tocitem" href="../../examples/agriculture_mccardle_farm/">The farm planning problem</a></li><li><a class="tocitem" href="../../examples/air_conditioning/">Air conditioning</a></li><li><a class="tocitem" href="../../examples/air_conditioning_forward/">Training with a different forward model</a></li><li><a class="tocitem" href="../../examples/all_blacks/">Deterministic All Blacks</a></li><li><a class="tocitem" href="../../examples/asset_management_simple/">Asset management</a></li><li><a class="tocitem" href="../../examples/asset_management_stagewise/">Asset management with modifications</a></li><li><a class="tocitem" href="../../examples/belief/">Partially observable inventory management</a></li><li><a class="tocitem" href="../../examples/biobjective_hydro/">Biobjective hydro-thermal</a></li><li><a class="tocitem" href="../../examples/booking_management/">Booking management</a></li><li><a class="tocitem" href="../../examples/generation_expansion/">Generation expansion</a></li><li><a class="tocitem" href="../../examples/hydro_valley/">Hydro valleys</a></li><li><a class="tocitem" href="../../examples/infinite_horizon_hydro_thermal/">Infinite horizon hydro-thermal</a></li><li><a class="tocitem" href="../../examples/infinite_horizon_trivial/">Infinite horizon trivial</a></li><li><a class="tocitem" href="../../examples/no_strong_duality/">No strong duality</a></li><li><a class="tocitem" href="../../examples/objective_state_newsvendor/">Newsvendor</a></li><li><a class="tocitem" href="../../examples/sldp_example_one/">SLDP: example 1</a></li><li><a class="tocitem" href="../../examples/sldp_example_two/">SLDP: example 2</a></li><li><a class="tocitem" href="../../examples/stochastic_all_blacks/">Stochastic All Blacks</a></li><li><a class="tocitem" href="../../examples/the_farmers_problem/">The farmer&#39;s problem</a></li><li><a class="tocitem" href="../../examples/vehicle_location/">Vehicle location</a></li></ul></li><li><a class="tocitem" href="../../apireference/">API Reference</a></li><li><a class="tocitem" href="../../release_notes/">Release notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How-to guides</a></li><li class="is-active"><a href>Use multithreading</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Use multithreading</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/odow/SDDP.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/odow/SDDP.jl/blob/master/docs/src/guides/use_multithreading.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Use-multithreading"><a class="docs-heading-anchor" href="#Use-multithreading">Use multithreading</a><a id="Use-multithreading-1"></a><a class="docs-heading-anchor-permalink" href="#Use-multithreading" title="Permalink"></a></h1><p>SDDP.jl can take advantage of the parallel nature of modern computers to solve problems across multiple threads.</p><h2 id="Enabling-threads"><a class="docs-heading-anchor" href="#Enabling-threads">Enabling threads</a><a id="Enabling-threads-1"></a><a class="docs-heading-anchor-permalink" href="#Enabling-threads" title="Permalink"></a></h2><p>By default, starting Julia with <code>julia</code> enables only a single thread. To enable more threads, you must start Julia from a command line using the <code>--threads</code> flag, where <code>N</code> is the number of threads to use:</p><pre><code class="language-julia hljs">julia --threads N</code></pre><p>Alternatively, you may set the <code>JULIA_NUM_THREADS</code> environment variable to <code>N</code> <strong>before</strong> starting Julia. (There is no way to change the number of threads once Julia has started.)</p><p>Once Julia has started, check how many threads you have available using <code>Threads.nthreads()</code>. For this online documentation, we set the <code>JULIA_NUM_THREADS</code> environment variable to <code>4</code> <strong>before</strong> starting Julia:</p><pre><code class="language-julia-repl hljs">julia&gt; ENV[&quot;JULIA_NUM_THREADS&quot;]
&quot;4&quot;

julia&gt; Threads.nthreads()
4</code></pre><h2 id="Multithreading-with-SDDP"><a class="docs-heading-anchor" href="#Multithreading-with-SDDP">Multithreading with SDDP</a><a id="Multithreading-with-SDDP-1"></a><a class="docs-heading-anchor-permalink" href="#Multithreading-with-SDDP" title="Permalink"></a></h2><p>To enable the multithreading algorithm in SDDP.jl, pass an instance of <a href="../../apireference/#SDDP.Threaded"><code>SDDP.Threaded</code></a> to the <code>parallel_scheme</code> argument of <a href="../../apireference/#SDDP.train"><code>SDDP.train</code></a> and <a href="../../apireference/#SDDP.simulate"><code>SDDP.simulate</code></a>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using SDDP, HiGHS</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; model = SDDP.LinearPolicyGraph(
           stages = 12,
           lower_bound = 0,
           optimizer = HiGHS.Optimizer,
       ) do sp, t
           @variable(sp, x &gt;= 0, SDDP.State, initial_value = 1)
           @stageobjective(sp, x.out)
       end</code><code class="nohighlight hljs ansi" style="display:block;">A policy graph with 12 nodes.
 Node indices: 1, ..., 12</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; SDDP.train(
           model;
           iteration_limit = 10,
           log_every_iteration = true,
           parallel_scheme = SDDP.Threaded(),
       )</code><code class="nohighlight hljs ansi" style="display:block;">-------------------------------------------------------------------
         SDDP.jl (c) Oscar Dowson and contributors, 2017-25
-------------------------------------------------------------------
problem
  nodes           : 12
  state variables : 1
  scenarios       : 1.00000e+00
  existing cuts   : false
options
  solver          : Threaded()
  risk measure    : SDDP.Expectation()
  sampling scheme : SDDP.InSampleMonteCarlo
subproblem structure
  VariableRef                             : [3, 3]
  VariableRef in MOI.GreaterThan{Float64} : [2, 2]
  VariableRef in MOI.LessThan{Float64}    : [1, 1]
numerical stability report
  matrix range     [0e+00, 0e+00]
  objective range  [1e+00, 1e+00]
  bounds range     [0e+00, 0e+00]
  rhs range        [0e+00, 0e+00]
-------------------------------------------------------------------
 iteration    simulation      bound        time (s)     solves  pid
-------------------------------------------------------------------
         1   0.000000e+00  0.000000e+00  1.261001e-01        54   1
         2   0.000000e+00  0.000000e+00  1.309180e-01        89   4
         3   0.000000e+00  0.000000e+00  1.322820e-01       112   3
         4   0.000000e+00  0.000000e+00  1.334641e-01       138   4
         5   0.000000e+00  0.000000e+00  1.337142e-01       143   2
         6   0.000000e+00  0.000000e+00  1.342881e-01       171   2
         7   0.000000e+00  0.000000e+00  1.358821e-01       204   4
         8   0.000000e+00  0.000000e+00  1.373460e-01       245   4
        10   0.000000e+00  0.000000e+00  1.385961e-01       264   3
        11   0.000000e+00  0.000000e+00  1.387751e-01       266   3
        12   0.000000e+00  0.000000e+00  1.407762e-01       310   4
        13   0.000000e+00  0.000000e+00  1.410251e-01       312   2
-------------------------------------------------------------------
status         : iteration_limit
total time (s) : 1.410251e-01
total solves   : 312
best bound     :  0.000000e+00
simulation ci  :  0.000000e+00 ± 0.000000e+00
numeric issues : 0
-------------------------------------------------------------------</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; simulations = SDDP.simulate(
           model,
           100;
           parallel_scheme = SDDP.Threaded(),
           custom_recorders =
               Dict{Symbol,Function}(:thread_id =&gt; sp -&gt; Threads.threadid()),
       );</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; simulations[1][1][:thread_id]</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; simulations[26][1][:thread_id]</code><code class="nohighlight hljs ansi" style="display:block;">2</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; simulations[51][1][:thread_id]</code><code class="nohighlight hljs ansi" style="display:block;">4</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; simulations[76][1][:thread_id]</code><code class="nohighlight hljs ansi" style="display:block;">3</code></pre><h2 id="Choosing-the-number-of-threads"><a class="docs-heading-anchor" href="#Choosing-the-number-of-threads">Choosing the number of threads</a><a id="Choosing-the-number-of-threads-1"></a><a class="docs-heading-anchor-permalink" href="#Choosing-the-number-of-threads" title="Permalink"></a></h2><p>As a rule of thumb, choose the number of threads to be less than or equal to the number of physical cores you have on your machine or the number of nodes in the graph, whichever is smaller.</p><p>The performance of the multithreaded algorithm in SDDP.jl is strongly limited by the number of nodes in your policy graph; more nodes is better. The number of threads that can be used is upper bounded by the number of nodes in the graph. For example, if you have a graph with three nodes, SDDP.jl will never use more than three threads, even if <code>--threads 4</code> is passed.</p><p>Even if you have a large number of nodes, using more threads than you have physical cores is likely to lead to bad performance. For example, on a quad-core laptop, using <code>--threads 52</code>, is likely to lead to bad performance, even if you have a graph with 52 nodes.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../tutorial/inventory/">« Example: inventory management</a><a class="docs-footer-nextpage" href="../access_previous_variables/">Access variables from a previous stage »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Wednesday 2 April 2025 07:09">Wednesday 2 April 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
